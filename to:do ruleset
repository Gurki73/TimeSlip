ğŸ“ Rule Engine To-Do List (Phased, decreasing granularity)
Phase 0 â€” Quick housekeeping / syntax fixes

Fix all remaining typos in property names:

refrenceRoles â†’ referenceRoles

dayly â†’ daily

comparissonOperator â†’ conditionLink

Remove placeholders / obsolete code (like derivedFromRepeat(Wx) in TimeframeDefs)

Ensure createRulset() initializes empty arrays correctly (weekly, daily, shiftly, special, corrupted)

Phase 1 â€” Atomic functions: timeframe part of createCondition()

Goal: canonical, fully testable, physical workforce only

Handle repeat patterns (W0â€“W4)

W0/W1 = default/every â†’ timeframeLogicOperator: AND

W2 = either â†’ timeframeLogicOperator: OR

W3 = only â†’ timeframeLogicOperator: ONLY, mark true/false per slot

W4 = X times â†’ timeframeLogicOperator: EXACT, store timeframeThreshold = X

Handle timeframe types (T0â€“T5)

T0, T2, T3 = day/week aggregation

T1 = shift (early/late/closer)

T5 = special absences (home office, vacation, sick)

Support shifts

Canonical: timeframeSlots = numbers (days) or strings (shift IDs)

W3 / ONLY â†’ expected true/false per slot (Option B)

W0/W1/W2/W4 â†’ aggregated evaluation, no splitting

Logging / testing

Console log input condition and resulting timeframeSlots, timeframeLogicOperator, timeframeThreshold

Test with fake conditions (e.g., early shift only Monday, every shift Tuesdayâ€“Thursday, etc.)

Phase 2 â€” Role handling (subjectRoles / referenceRoles)

Map groups G0â€“G2 consistently

G0 = single role

G1 = AND group

G2 = OR group

Map dependencies D0/D2/D3 consistently

D0 = presence / total

D2 = â€œneedsâ€ / ratio

D3 = â€œhelpsâ€ / ratio

Clean naming, no overlap with UI/human labels

Log results for testing

Phase 3 â€” Condition translation / machine rules

translateToMachine(inputRule)

Produce canonical rule with:

dominantCondition

submissiveCondition

conditionLink

Respect exceptions E0â€“E6

E0 = single condition

E1 = AND

E2 = OR

E3/E4/E5/E6 â†’ special, possibly â€œunlessâ€ or min/max

Maintain same structure for all rules

Log output for test inputs

Phase 4 â€” Evaluation function skeleton

For physical shifts / days only

Evaluate each condition per unit (day/shift)

Boolean output only

Apply conditionLink logic:

single, AND, OR, XOR, unless, LIMIT_MIN, LIMIT_MAX

Special handling for EXACT (W4) â†’ check threshold

Integrate special absences (T5) â†’ automatically mark unavailable

Phase 5 â€” Integration / diagnostics

Ensure machineRuleset stores rules by type:

weekly, daily, shiftly, special, corrupted

Log rule evaluation per day/shift

Keep ruleId for human-readable mapping

Prepare for calendar UI consumption

Optional: prepare typing effect / dependency matrix examples

Phase 6 â€” Cleanup / testing / polish

Remove all comments / old notes / pseudo-code

Ensure consistent naming across the engine

Full test with real UI input rules

Verify logs match expectations

Add sample conditions for manual testing

Document canonical structure for future devs